Бесконтактная оплата возможна благодаря чипу NFC![[Screenshot 2024-04-25 at 11.03.10 AM.png]]
- NFC - Near Field Communication (взаимодействие близкого поля):
1. В карту встроен чип NFC и антенна - магнитная проволока, смотанная кольцами.
2. Когда на терминале включается оплата, терминал начинает излучать слабое магнитное поле.
3. Когда мы приближаем карту к терминалу, она попадает в поле, и благодаря антеннам на чипе появляется ток.
4. Чип начинает работать и посылать в ответ какой-то свой импульс, тоже в виде магнитного поля.
5. Терминал оплаты улавливает этот импульс, раскодирует его и начинает процесс оплаты.

- Чтобы оплата проходила, нужна *платежная система* - это посредник, который помогает обмениваться деньгами между банками.
![[Screenshot 2024-04-25 at 11.10.15 AM.png]]
- Передача данных с карты
	Когда мы подносим карту к терминалу, то с карты отправляются на терминал не деньги, а токен.
		Токен - это последовательность символов, которая что-то значит для отправителя и получателя.
	В нашем случае в токене содержится зашифрованная информация о платёжной системе и номере карты.
	
- Проверка токена
	Терминал, получив токен, сразу его проверяет - соответствует ли он стандартному банковскому токену или это что-то другое. 
	Если да - токен идет дальше, нет - терминал даже не пытается связаться с банком и сразу выдает ошибку.
		*Наглядный пример проверки токена - если убрать карту слишком быстро, то в этом случае терминал получит неполный токен и покажет ошибку "карта не читается".
		
- Токен пришел в банк продавца
	Когда банк получает токен, он его расшифровывает и узнает следующее:
	1. действительна ли карта и не вышел ли срок действия
	2. платежная система карты
	3. название банка, который выдал карту
	4. реквизиты карты
	После получения банк отправляет запрос в платежную систему
		*Слушай, тут клиент банка такого-то хочет купить что-то за 7000 рублей. Вот реквизиты карты. Одобряешь операцию?*
		
- Печать слипа
	Ответ платежной системы записывается в память платежного терминала, а еще из него вылезает маленький чек - ==слип==
	Слип подтверждает, что совершилась такая-то транзакция с таким-то результатом. Это не подтверждение покупки, а лишь факт обмена данными с платежной системой.

- Обмен деньгами
	Ночью платежная система сверяет все рачеты и составляет ведомость: кто кому сколько задолжал. Инфа отправляется в банк, и уже они обмениваются деньгами. Платежная система выставляет счет на комиссию с каждого банка.
	*На первом этапе* платежная система считает всякие кешбэки, акции, бонусы. В мобильном приложении отображаются сразу, но фактически они придут только ночью.
	
- Могут ли списать деньги с карты в толпе, если у тебя есть NFC-считыватель?
	Для снятия денег нужен не NFC-считыватель, а банковский терминал. Даже если взять его и так списывать суммы меньше тысячи рублей (чтобы не вводить пин-код), то схема быстро перестанет работать, а все украденные деньги вернутся назад.
	Дело в том, что сейчас при каждой такой оплате клиенту приходит СМС-уведомление или пуш в личном кабинете банка. Если человек не совершал эту операцию, он может её заблокировать и пожаловаться в банк.
	Каждая такая жалоба разбирается службой безопасности банка: они связываются с банком, который выдал терминал, и узнают, в чём дело. Если владелец терминала не сможет предоставить в банк реальные доказательства продажи, все платежи отменятся, терминал заблокируют, владельца терминала внесут в чёрный список, а то и могут возбудить какое-нибудь дело.