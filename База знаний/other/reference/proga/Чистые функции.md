*посмотреть - https://www.youtube.com/watch?v=Pc6qX0HfDs4&list=PLfdmaUSuGbkJXsbcwqdv713e9mvCc-3xd&index=39&t=44s&pp=gAQBiAQB

Поговорим про основную концепцию функционального программирования. Программа в функциональном стиле — программа, состоящая из чистых функций.

- **Чистыми** называют функции, которые являются детерминированными и не имеют побочных эффектов.

- **Детерминированность**. Для одного и того же набора входных значений функция возвращает одинаковый результат.

- **Отсутствие побочных эффектов**. Функция вообще никак не взаимодействует с внешним миром, кроме вызова других чистых функций и возврата своего результата: не может менять переданные ей аргументы, не может менять глобальные переменные, не может писать или читать что-то с консоли.
```c#
Func<int, int> f = x => 3 * x; // чистая

// остальные примеры не чистые
Func<int, int> f1 = x => x + i; // зависит не только от своих аргументов
Func<int, int> f2 = x => x + new Random().Next(); // не детерминирована
Func<int, int> f3 = x => { Console.Write("!"); return x; }; // влияет на внешний мир
Func<int[], int> f4 = x => { x[0] = 3; return 3; }; // меняет переданный аргумент
```

#### Некоторые следствия чистоты

1. Если результат чистой функции не используется, ее вызов может быть удален без вреда для других выражений.
2. Замена вызова чистой функции на ее результат никак не поменяет работу программы. Вместо вызова `f(3)` из примера можно сразу написать константу `9`.
3. Если функции не зависят друг от друга по данным, их можно выполнять в любом порядке. Например, в выражении `f(a) + g(b)` можно вычислить сначала `f`, потом `g`, можно наоборот, а можно вообще одновременно (на двух ядрах).
#### Достоинства чистых функций

1. Повышение надежности кода за счет четкой структуры и отсутствия необходимости отслеживания побочных эффектов.
2. Удобство тестирования за счет отсутствия побочных эффектов.
3. Возможность оптимизации при компиляции, т.к. последовательность вызовов функций не фиксирована.
4. Широкие возможности для автоматического распараллеливания вычислений.
#### Недостатки чистых функций

1. Лишнее выделение памяти из-за неизменяемости аргументов и отсутствия глобальных переменных. Высокая нагрузка на сборщик мусора.
2. Функции ввода-вывода, работы с сетью и подобные не могут быть чистыми.
#### Применение в С# 

В списке достоинств чистоты надежность, понятность кода и удобство тестирования. Советы по применению:

- Избегайте побочных эффектов. Предположим, метод помимо основного действия производит еще и побочный эффект. Значит, он делает 2 действия. Может, получится его разбить на 2 метода, один из которых будет чистый. Либо получится передать в метод выше лишнюю ответственность, например, запись на консоль.

- Не меняйте переданные в метод входные аргументы. Например, будет неожиданным, если после выполнения `GetMedian(numbers)` массив чисел окажется отсортирован.

- Используйте неизменяемые структуры данных. Тот же `GetMedian` может вместо `List` принимать `IReadonlyList`, тогда компилятор не даст изменить элементы списка. Еще пример: Класс `Vector` можно реализовать так, чтобы все операции изменения создавали новый объект `vector`, а не меняли текущий. Это похоже на то, что происходит в строках.

- Метафору чистоты можно перенести на классы. Вызовы методов чистого класса должны менять только его состояние, но не окружающий мир. Результат методов должен зависеть только от переданных аргументов и внутреннего состояния объекта. Такой класс будет независим от остальной части программы и его легко будет тестировать.

- ==Передавайте в linq-методы только чистые функции.== Другие программисты не ожидают побочных эффектов в этом месте. Для грязных дел есть for. Методы linq ленивые, поэтому их цепочка выполняется задом наперед. Вообще не разобраться, если при этом еще будут побочные эффекты.